<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 1</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/google/code-prettify@master/src/prettify.css">
    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/src/prettify.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre code').forEach((el) => {
          hljs.highlightElement(el);
        });
      });</script>
    <link rel="stylesheet" href="https://pygments.org/static/css/default.css">
</head>
<body>
  <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PS70 Bobby</title>
    
    <link rel = "stylesheet" href = "styles.css">
    <script>
        function navigate() {
            var selectElement = document.getElementById("pageSelect");
            var selectedValue = selectElement.value;
            if (selectedValue) {
                window.location.href = selectedValue;
            }
        }
    </script>
    <script>
      window.onload = function() {
          PR.prettyPrint();
      };
  </script>
</head>
<body>
    <div class = "navbar">
        <img src = "py-logo.svg" alt = "python logo"></img>
        <a href = "index.html" style = "text-decoration: none; font-size: 14px;">Phys-Sci »</a>
        <select style="width: 7%;">
            <option> English </option>
            <option disabled> I don't know other languages :(</option>
        </select>
        <select style="width: 6%;" id="pageSelect" onchange="navigate()">
            <option value = "index.html"> Home Page</option>
            <option value = "week1.html"> Week 1</option>
            <option value = "week2.html"> Week 2</option>
            <option value = "week3.html"> Week 3</option>
            <option value = "week4.html"> Week 4</option>
            <option value = "week5.html"> Week 5</option>
            <option value = "week6.html"> Week 6</option>
            <option value = "week7.html"> Week 7</option>
            <option value = "week8.html"> Week 8</option>
            <option value = "https://ctian5136.github.io/ps70/html/weeks/week9.html"> Week 9</option>
            <option value = "https://geometrikz.github.io/PS70/blog/week_10/"> Week 10</option>
            <option value = "finalProject.html"> Final Project</option>
        </select>
        <p>70.0.1 Documentation »</p>
    </div>
    <div class = "grid">
        <div class = "sidenav">
            <p>Download</p>
            <p>Docs by Week</p>
            <ul class = "weekLinks">
                <li>
                    <a href = "week1.html"> Week 1: Intro</a>
                </li>
                <li>
                    <a href = "week2.html"> Week 2: 2D Design</a>
                </li>
                <li>
                    <a href = "week3.html"> Week 3: Hand tools</a>
                </li>
                <li>
                    <a href = "week4.html"> Week 4: Microcontrollers</a>
                </li>
                <li>
                    <a href = "week5.html"> Week 5: 3D Design</a>
                </li>
                <li>
                    <a href = "week6.html"> Week 6: Input Devices</a>
                </li>
                <li>
                    <a href = "week7.html"> Week 7: Output Devices</a>
                </li>
                <li>
                    <a href = "week8.html"> Week 8: Mill, Mold & Cast</a>
                </li>
                <li>
                    <a href = "https://ctian5136.github.io/ps70/html/weeks/week9.html"> Week 9: Internet of Things</a>
                </li>
                <li>
                    <a href = "https://geometrikz.github.io/PS70/blog/week_10/"> Week 10: Machine Building</a>
                </li>
                <li>
                    <a href = "finalProject.html"> Final Project: Insult Robot</a>
                </li>
            </ul>      
        </div>
        <div class="main-content">
            <h1>Week 7: Output Devices</h1>
            
            <h3>Oscilloscope</h3>
            <p>
                Using an Oscilloscope was actually very helpful for this week because I had run into an issue 
                with the wireless charger I was planning on using for my final project. The main issue being that 
                when I used a multimeter and measure a specific pin on the wireless charger it read 5V when there 
                was no phone on it, and 2.5V when a phone was on it and being charged. However, when I hooked it up 
                to my ESP32S2 I was getting widely different results when I used analogRead on the pin with values varing between 0 and 5 volts.
                So I wanted to look at the oscilloscope to get a better sense of what was going on with the voltage output by the wireless charger.
            </p>
            <div style = "display: flex;">
                <div>
                    <h3>Reading when Phone is not on Charger</h3>
                    <img src = "week7Assets/scope-no-phone.jpg"></img>
                </div>
                <div>
                    <h3>Reading when Phone is on Charger</h3>
                    <img src = "week7Assets/scope-with-phone.jpg"></img>
                </div>
            </div>
            <p>
                From the oscilloscope, I see that when the charger is not charging a phone it outputs a consistent voltage which makes sense with the 5V that
                I read on the multimeter. However, when you put the phone on the wireless charger there is a fluctation in the voltage by 5 Volts (fluctuating
                between 5 and 0 at an interval of about every 0.3 milliseconds or 300 microseconds). This reading help me understand the problems I was having 
                with reading the voltage on my ESP32S2. At first the multimeter gave me the impression that when the phone is on the charger, that the pin I was measure
                goes from outputting a consistent 5V to a consistent 2.5V. However, that is not what it does, it fluctutates between 5 and 0 volts, and I am guessing
                that the amount of sampling the multimeter is much higher than what the ESP32 does when it calls analogRead and because of that the multimeter produces a 
                of 2.5V because it takes a lot of samples and the average of 5 and 0 is 2.5. While when the ESP32 calls analogRead it returns a value much closer
                to 5 or 0. And if I want to solve this problem myself then I will have to implement sampling on my own, and call analogRead multiple times and average those
                readings to get a reading close to 2.5V.
            </p>
            <h2>Wireless Charger and Speaker Setup</h2>

            <img src = "week7Assets/speaker-charger-setup.jpg"></img>
            <video  style="width:50vw;" controls>
                <source src = "week7Assets/output-demo.mp4", type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <h3>Main.ino</h3>
            <pre class="prettyprint pre" >
                <code class="language-cpp code" >
                    #include "PhoneDetector.h"
                    #include "SoundData.h"
                    #include "XT_DAC_Audio.h"

                    XT_Wav_Class *test;
                    XT_Wav_Class Sound(Force);     
                                     
                    XT_DAC_Audio_Class DacAudio(25,0);    

                    uint32_t DemoCounter=0;   
                    bool phoneDetected = false;
                    PhoneDetector detector(34);

                    void setup() {
                    Serial.begin(115200); 
                    pinMode(phonePin, INPUT);
                    test = &Sound;              
                    }

                    void loop() {
                    phoneDetected = detector.detect();
                    DacAudio.FillBuffer();                
                    if((*test).Playing==false && !phoneDetected)       
                        DacAudio.Play(test);       
                    // Serial.println(phoneDetected);        
                    }

                </code>
            </pre>
            <h3>PhoneDetector.h</h3>
            <pre class="prettyprint pre" >
                <code class="language-cpp code" >
                    #ifndef PhoneDetector_h
                    #define PhoneDetector_h

                    #include <Arduino.h>
                    #include "StudyTimer.h"

                    class PhoneDetector{
                    private:
                        bool procrastinating;
                        int phonePin; 
                    public:
                        PhoneDetector(int pin);
                        bool detect();
                        void signal(bool procrastinating);      
                    };

                    #endif
                </code>
            </pre> 
            <h3>PhoneDetector.cpp</h3>
            <pre class="prettyprint pre" >
                <code class="language-cpp code" >
                    #include "PhoneDetector.h";
                    #include "StudyTimer.h";

                    PhoneDetector::PhoneDetector(int pin){
                    this->phonePin = pin;
                    procrastinating = false;
                    pinMode(this->phonePin, INPUT);
                    }

                    // Return true if phone is on charger false otherwise 
                    bool PhoneDetector::detect(){
                    int sample = 0;
                    int SAMPLE_SIZE = 350;
                    for(int i = 0; i < SAMPLE_SIZE; i++){
                        sample += analogRead(phonePin);
                    }
                    // Serial.println((sample / SAMPLE_SIZE));
                    return (sample / SAMPLE_SIZE) < 7000;

                    }

                    void PhoneDetector::signal(bool procrastinating){
                    Serial.println(procrastinating ? "this person is procrastinating" : "this person is no longer procrastinating");
                    }
                </code>
            </pre> 
            

        </div>      
    </div>
